<div fxLayout="column" fxFill>
  <mat-toolbar color="primary">
    <button mat-icon-button (click)="onToggleLeftSideNavClicked()" *ngIf="!!currentComic">
      <mat-icon>menu</mat-icon>
    </button>

    <span>
      Vecomic
      {{currentComic ? '- ' + currentComic.title + ' ' : ''}}
      {{currentPath ? '- ' + currentPath + ' ' : ''}}
      {{currentPage ? '[' + currentPage.title + ']' : ''}}
      {{currentComic && currentComic.dirty ? ' *' : ''}}
    </span>

    <span fxFlex="1 1 auto"></span>

    <button mat-icon-button (click)="onNewFolderClicked()">
      <mat-icon>create_new_folder</mat-icon>
    </button>
    <button mat-icon-button (click)="onOpenFolderClicked()">
      <mat-icon>folder_open</mat-icon>
    </button>
    <button mat-icon-button (click)="onSaveClicked()" *ngIf="!!currentComic"
            [disabled]="!currentComic.dirty">
      <mat-icon>save</mat-icon>
    </button>
    <button mat-icon-button (click)="onCloseFolderClicked()" *ngIf="!!currentComic">
      <mat-icon>close</mat-icon>
    </button>
  </mat-toolbar>

  <mat-drawer-container fxFlex>
    <mat-drawer mode="over" [(opened)]="leftSideNavOpened">
      <mat-action-list class="left-side-nav" cdkDropList (cdkDropListDropped)="onPageListReordered($event)"
                *ngIf="!!currentComic">
        <h3 mat-subheader fxLayout="row">
          Pages
          <span fxFlex="1 1 auto"></span>
          <button mat-icon-button (click)="onAddPageClicked()">
            <mat-icon>add</mat-icon>
          </button>
        </h3>

        <mat-list-item *ngFor="let page of currentComic.pages" cdkDrag fxLayout="row"
                       (click)="switchToPage(page.id)" [ngClass]="{'current-page': page.id === currentPageId}">
          <h4 class="page-title" mat-line>{{page.title}}</h4>

          <span fxFlex="1 1 auto"></span>

          <button mat-icon-button (click)="onChangePageTitleClicked(page.id, $event)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button (click)="onRemovePageClicked(page, $event)" *ngIf="currentComic.pages.length > 1">
            <mat-icon>delete</mat-icon>
          </button>
          <button mat-icon-button cdkDragHandle (click)="$event.stopPropagation()"
                  *ngIf="currentComic.pages.length > 1">
            <mat-icon>drag_handle</mat-icon>
          </button>
        </mat-list-item>
      </mat-action-list>
    </mat-drawer>
    <mat-drawer-content>
      <as-split direction="horizontal" fxLayout="row" *ngIf="!!currentComic">
        <as-split-area size="50" fxLayout="column">
          <div #canvasContainer class="canvas-container" fxFlex="1 1 auto">
            <div class="canvas-overlay canvas-grid" [hidden]="!showGrid"
                 [ngStyle]="{'transform': 'scale(' + sessionSettings.zoomPercentage / 100 + ')'}">
              <svg xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <pattern id="smallGrid" [attr.width]="comicSettings.grid.smallUnitSize"
                            [attr.height]="comicSettings.grid.smallUnitSize"
                            patternUnits="userSpaceOnUse">
                    <path [attr.d]="'M ' + comicSettings.grid.smallUnitSize + ' 0 L 0 0 0 ' + comicSettings.grid.smallUnitSize"
                          fill="none"
                          [attr.stroke]="comicSettings.grid.smallUnitLineColor"
                          [attr.stroke-width]="comicSettings.grid.smallUnitLineWidth" />
                  </pattern>

                  <pattern id="grid" [attr.width]="comicSettings.grid.bigUnitSize"
                            [attr.height]="comicSettings.grid.bigUnitSize" patternUnits="userSpaceOnUse">
                    <rect [attr.width]="comicSettings.grid.bigUnitSize"
                          [attr.height]="comicSettings.grid.bigUnitSize" fill="url(#smallGrid)" />
                    <path [attr.d]="'M ' + comicSettings.grid.bigUnitSize + ' 0 L 0 0 0 ' + comicSettings.grid.bigUnitSize"
                          fill="none" [attr.stroke]="comicSettings.grid.bigUnitLineColor"
                          [attr.stroke-width]="comicSettings.grid.bigUnitLineWidth" />
                  </pattern>
                </defs>

                <rect width="100%" height="100%" fill="url(#grid)" />
              </svg>
            </div>

            <div class="canvas-overlay canvas-rulers" [hidden]="!showRuler"
                 [ngStyle]="{'transform': 'scale(' + sessionSettings.zoomPercentage / 100 + ')'}">
              <div #verticalRuler class="canvas-ruler canvas-ruler-vertical">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" vc-fixed="width">
                  <defs>
                    <pattern id="smallVerticalRulerMark" [attr.width]="comicSettings.grid.smallUnitSize"
                              [attr.height]="comicSettings.grid.smallUnitSize"
                              patternUnits="userSpaceOnUse">
                      <path [attr.d]="'M ' + comicSettings.grid.smallUnitSize + ' 0 L 0 0'"
                            fill="none"
                            [attr.stroke]="comicSettings.ruler.smallUnitLineColor"
                            [attr.stroke-width]="comicSettings.ruler.smallUnitLineWidth" />
                    </pattern>

                    <pattern id="bigVerticalRulerMark" [attr.width]="comicSettings.grid.bigUnitSize"
                              [attr.height]="comicSettings.grid.bigUnitSize" patternUnits="userSpaceOnUse">
                      <rect [attr.width]="comicSettings.grid.bigUnitSize"
                            [attr.height]="comicSettings.grid.bigUnitSize" fill="url(#smallVerticalRulerMark)" />
                      <path [attr.d]="'M ' + comicSettings.grid.bigUnitSize + ' 0 L 0 0'"
                            fill="none" [attr.stroke]="comicSettings.ruler.bigUnitLineColor"
                            [attr.stroke-width]="comicSettings.ruler.bigUnitLineWidth" />
                    </pattern>
                  </defs>

                  <rect width="20" height="100%" x="0" fill="url(#bigVerticalRulerMark)" />

                  <text *ngFor="let y of horizontalRulerMarks" x="1" [attr.y]="y + 1"
                        [attr.transform]="'rotate(90, 1, ' + (y + 1) + ')'"
                        [attr.color]="comicSettings.ruler.bigUnitLineColor">
                    {{y}}
                  </text>
                </svg>
              </div>

              <div #horizontalRuler class="canvas-ruler canvas-ruler-horizontal">
                <svg xmlns="http://www.w3.org/2000/svg" height="20" vc-fixed="height">
                  <defs>
                    <pattern id="smallHorizontalRulerMark" [attr.width]="comicSettings.grid.smallUnitSize"
                              [attr.height]="comicSettings.grid.smallUnitSize"
                              patternUnits="userSpaceOnUse">
                      <path [attr.d]="'M 0 ' + comicSettings.grid.smallUnitSize + ' L 0 0'"
                            fill="none"
                            [attr.stroke]="comicSettings.ruler.smallUnitLineColor"
                            [attr.stroke-width]="comicSettings.ruler.smallUnitLineWidth" />
                    </pattern>

                    <pattern id="bigHorizontalRulerMark" [attr.width]="comicSettings.grid.bigUnitSize"
                              [attr.height]="comicSettings.grid.bigUnitSize" patternUnits="userSpaceOnUse">
                      <rect [attr.width]="comicSettings.grid.bigUnitSize"
                            [attr.height]="comicSettings.grid.bigUnitSize" fill="url(#smallHorizontalRulerMark)" />
                      <path [attr.d]="'M 0 ' + comicSettings.grid.bigUnitSize + ' L 0 0'"
                            fill="none" [attr.stroke]="comicSettings.ruler.bigUnitLineColor"
                            [attr.stroke-width]="comicSettings.ruler.bigUnitLineWidth" />
                    </pattern>
                  </defs>

                  <rect width="100%" height="20" y="0" fill="url(#bigHorizontalRulerMark)" />

                  <text *ngFor="let x of horizontalRulerMarks" [attr.x]="x + 1" y="12"
                        [attr.color]="comicSettings.ruler.bigUnitLineColor">
                    {{x}}
                  </text>
                </svg>
              </div>
            </div>

            <div #mouseCrosshairArea class="canvas-overlay canvas-mouse-crosshair" (mouseenter)="onMouseCrosshairEnter()"
                 (mousemove)="onMouseCrosshairMove($event)"
                 (mouseleave)="onMouseCrosshairLeave()" [hidden]="!showRuler">
              <div #verticalMouseCrosshair class="crosshair-vertical" [hidden]="!showMouseCrosshair"></div>
              <div #horizontalMouseCrosshair class="crosshair-horizontal" [hidden]="!showMouseCrosshair"></div>
            </div>

            <div #canvas class="canvas"
                 [ngStyle]="{'transform': 'scale(' + sessionSettings.zoomPercentage / 100 + ')'}"></div>
          </div>

          <mat-toolbar fxFlex="0 0 auto" fxLayout="row">
            <button mat-icon-button *ngIf="showGrid" (click)="toggleGrid(false)">
              <mat-icon>grid_off</mat-icon>
            </button>
            <button mat-icon-button *ngIf="!showGrid" (click)="toggleGrid(true)">
              <mat-icon>grid_on</mat-icon>
            </button>

            <button mat-icon-button (click)="toggleRuler(!showRuler)">
              <mat-icon>straighten</mat-icon>
            </button>

            <div class="zoom-control" fxFlex="1 1 auto">
              <button mat-icon-button (click)="onSvgContentZoomInClicked()">
                <mat-icon>zoom_in</mat-icon>
              </button>

              <input type="number" class="zoom-value-input"
                      [(ngModel)]="sessionSettings.zoomPercentage">
              <span class="zoom-value-input-suffix">%</span>

              <button mat-icon-button (click)="onSvgContentZoomOutClicked()">
                <mat-icon>zoom_out</mat-icon>
              </button>
            </div>

            <button mat-icon-button [matMenuTriggerFor]="svgContentLayerMenu">
              <mat-icon>layers</mat-icon>
            </button>

            <button mat-icon-button (click)="onSvgContentSettingsClicked()">
              <mat-icon>tune</mat-icon>
            </button>
          </mat-toolbar>
        </as-split-area>

        <as-split-area #codeEditor size="50" class="code-editor"></as-split-area>
      </as-split>

      <div class="empty-content" *ngIf="!currentComic">
        No comic opened
      </div>
    </mat-drawer-content>
  </mat-drawer-container>
</div>

<mat-menu #svgContentLayerMenu="matMenu" yPosition="above">
  <mat-checkbox *ngFor="let l of pageDetails?.layers || []"
                class="layer-menu-item"
                [checked]="!sessionPageSettings.hiddenLayers[l]"
                (change)="onSvgContentLayerVisibilityChanged(l, $event)"
                (click)="$event.stopPropagation()">
    {{l}}
  </mat-checkbox>

  <span class="layer-menu-no-layers"
        *ngIf="(pageDetails?.layers?.length || 0) === 0">(No layers)</span>
</mat-menu>
